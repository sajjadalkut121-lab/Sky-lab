import 'package:flutter/material.dart';
import 'dart:async';

void main() => runApp(const DragonSkyApp());

class DragonSkyApp extends StatefulWidget {
  const DragonSkyApp({super.key});
  @override
  State<DragonSkyApp> createState() => _DragonSkyAppState();
}

class _DragonSkyAppState extends State<DragonSkyApp> {
  bool isArabic = true; 
  void toggleLang() => setState(() => isArabic = !isArabic);

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      debugShowCheckedModeBanner: false,
      locale: Locale(isArabic ? 'ar' : 'en'),
      theme: ThemeData.dark(),
      home: DragonHome(isArabic: isArabic, onLangChange: toggleLang),
    );
  }
}

class DragonHome extends StatefulWidget {
  final bool isArabic;
  final VoidCallback onLangChange;
  const DragonHome({super.key, required this.isArabic, required this.onLangChange});

  @override
  State<DragonHome> createState() => _DragonHomeState();
}

class _DragonHomeState extends State<DragonHome> {
  int _tab = 0;
  double liveProfit = 15.21657;
  double calcAmount = 100.0; // للحاسبة

  @override
  void initState() {
    super.initState();
    Timer.periodic(const Duration(seconds: 1), (t) => setState(() => liveProfit += 0.00015));
  }

  String txt(String ar, String en) => widget.isArabic ? ar : en;

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      backgroundColor: const Color(0xFF080C12),
      appBar: AppBar(
        backgroundColor: Colors.transparent, elevation: 0,
        title: Text(txt("سكاي لاب - العرين", "SKY LAB DRAGON"), style: const TextStyle(fontWeight: FontWeight.bold, fontSize: 18)),
        actions: [IconButton(onPressed: widget.onLangChange, icon: const Icon(Icons.language, color: Colors.cyanAccent))],
      ),
      body: _screens()[_tab],
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _tab, onTap: (i) => setState(() => _tab = i),
        type: BottomNavigationBarType.fixed, backgroundColor: const Color(0xFF11171E),
        selectedItemColor: Colors.cyanAccent, unselectedItemColor: Colors.white24,
        items: [
          BottomNavigationBarItem(icon: const Icon(Icons.show_chart), label: txt("استثمار", "Invest")),
          BottomNavigationBarItem(icon: const Icon(Icons.calculate), label: txt("الحاسبة", "Calc")),
          BottomNavigationBarItem(icon: const Icon(Icons.account_balance_wallet), label: txt("إيداع", "Deposit")),
          BottomNavigationBarItem(icon: const Icon(Icons.person), label: txt("حسابي", "Me")),
        ],
      ),
    );
  }

  List<Widget> _screens() => [
    _investTab(),
    _calculatorTab(),
    _depositTab(),
    _profileTab(),
  ];

  // --- واجهة الاستثمار (نمط المقطع) ---
  Widget _investTab() => ListView(padding: const EdgeInsets.all(15), children: [
    _buildLiveCard(),
    const SizedBox(height: 20),
    // شريط إثباتات السحب المتحرك
    Container(
      padding: const EdgeInsets.all(8),
      decoration: BoxDecoration(color: Colors.greenAccent.withOpacity(0.1), borderRadius: BorderRadius.circular(10)),
      child: Row(children: [
        const Icon(Icons.verified_user, color: Colors.greenAccent, size: 16),
        const SizedBox(width: 10),
        Text(txt("سحب المستخدم A***2 مبلغ 45 USDT بنجاح", "User A***2 withdrawn 45 USDT successfully"), style: const TextStyle(fontSize: 10, color: Colors.white70)),
      ]),
    ),
    const SizedBox(height: 20),
    _vipCard("VIP 1", 50, 1.08),
    _vipCard("VIP 2", 100, 2.17),
    _vipCard("VIP 3", 500, 10.85),
  ]);

  Widget _buildLiveCard() => Container(
    padding: const EdgeInsets.all(25),
    decoration: BoxDecoration(
      gradient: const LinearGradient(colors: [Color(0xFF1E2631), Color(0xFF0D1219)]),
      borderRadius: BorderRadius.circular(25), border: Border.all(color: Colors.cyanAccent.withOpacity(0.2)),
    ),
    child: Column(children: [
      Text(txt("أرباح التعدين الحالية", "Current Mining Profit"), style: const TextStyle(color: Colors.white38)),
      Text("\$${liveProfit.toStringAsFixed(6)}", style: const TextStyle(color: Colors.cyanAccent, fontSize: 32, fontWeight: FontWeight.bold)),
      const SizedBox(height: 15),
      ElevatedButton(onPressed: (){}, style: ElevatedButton.styleFrom(backgroundColor: Colors.cyanAccent), child: Text(txt("نقل للمحفظة", "Collect Now"), style: const TextStyle(color: Colors.black))),
    ]),
  );

  // --- حاسبة الأرباح الجديدة ---
  Widget _calculatorTab() => Padding(padding: const EdgeInsets.all(25), child: Column(children: [
    Text(txt("احسب أرباحك المتوقعة", "Calculate Your Profits"), style: const TextStyle(fontSize: 20, color: Colors.cyanAccent)),
    const SizedBox(height: 30),
    TextField(
      keyboardType: TextInputType.number,
      onChanged: (v) => setState(() => calcAmount = double.tryParse(v) ?? 0),
      decoration: InputDecoration(labelText: txt("مبلغ الاستثمار (\$)", "Investment Amount (\$)"), border: const OutlineInputBorder()),
    ),
    const SizedBox(height: 20),
    _calcRow(txt("الربح اليومي:", "Daily:"), "\$${(calcAmount * 0.0217).toStringAsFixed(2)}"),
    _calcRow(txt("الربح الشهري:", "Monthly:"), "\$${(calcAmount * 0.0217 * 30).toStringAsFixed(2)}"),
    _calcRow(txt("الربح السنوي:", "Yearly:"), "\$${(calcAmount * 0.792).toStringAsFixed(2)}", color: Colors.cyanAccent),
  ]));

  // --- واجهة الإيداع مع رفع الوصل ---
  Widget _depositTab() => SingleChildScrollView(padding: const EdgeInsets.all(25), child: Column(children: [
    Text(txt("عنوان الإيداع (USDT TRC20)", "Deposit Address"), style: const TextStyle(color: Colors.amber)),
    const SelectableText("0xdebe6cddf95631cff63368483995608d4d8263d3", style: TextStyle(fontSize: 12, color: Colors.white38)),
    const SizedBox(height: 30),
    Container(
      height: 150, width: double.infinity,
      decoration: BoxDecoration(color: Colors.white10, borderRadius: BorderRadius.circular(15), border: Border.all(style: BorderStyle.none)),
      child: Column(mainAxisAlignment: MainAxisAlignment.center, children: [
        const Icon(Icons.cloud_upload, size: 40, color: Colors.white24),
        Text(txt("ارفع صورة وصل التحويل هنا", "Upload Transfer Receipt"), style: const TextStyle(color: Colors.white24, fontSize: 12)),
      ]),
    ),
    const SizedBox(height: 20),
    ElevatedButton(onPressed: (){}, child: Text(txt("تأكيد العملية", "Confirm Deposit"))),
  ]));

  Widget _profileTab() => const Center(child: Text("Profile Page"));
  Widget _vipCard(String n, double p, double d) => Card(color: const Color(0xFF161D26), child: ListTile(title: Text(n, style: const TextStyle(color: Colors.cyanAccent)), subtitle: Text(txt("ربح يومي: \$$d", "Daily Profit: \$$d")), trailing: Text("\$$p", style: const TextStyle(fontWeight: FontWeight.bold))));
  Widget _calcRow(String t, String v, {Color color = Colors.white70}) => Padding(padding: const EdgeInsets.symmetric(vertical: 10), child: Row(mainAxisAlignment: MainAxisAlignment.spaceBetween, children: [Text(t), Text(v, style: TextStyle(color: color, fontWeight: FontWeight.bold))]));
}
